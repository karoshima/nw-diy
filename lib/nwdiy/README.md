NW-DIY // lib/nwdiy

====

NW-DIY のライブラリ群

## vm.rb

仮想マシンクラス NwDiy::VM では以下の仕事をしています。

* インターフェースの管理
* 全インターフェースのどれかからのパケット受信

## timerhash.rb

ruby の Hash に似せたクラスです。
各データに寿命を設けています。

## interface.rb, interface/

インターフェースクラス NwDiy::Interface では以下の仕事をしています。

* インターフェース名やインターフェース権限を見て適切なインスタンスを作る。
* MAC アドレスをひとつ持つ。
* パケットを受信する

なお内部では interface/ 配下のクラスを使って実際のパケット送受信を行ないます。

### interface/pcap.rb

pcap を使いたかったけど、ruby から使う方法よく分からなかったので、
socket(AF_PACKET) を使ってパケット送受信します。

### interface/proxy.rb

pcap.rb を使いたかったけど root 権限がなくて使えなかったとき
util/interface_daemon.rb を経由してパケット送受信します。

### interface/sock.rb

実在するインターフェースの代わりに、仮想インターフェースを作って
パケット送受信します。仮想インターフェースにパケット送信すると、
ほかの「同一名称の」仮想インターフェースでパケット受信できます。

### interface/iplink.rb

実在するインターフェースの情報を得るために、内部的に使っています。

## packet.rb, packet/

パケットやフレームを表すモジュール NwDiy::Packet は、
イーサネットフレームや IP パケットなどの各レイヤの
パケットあるいはフレームに相当します。

実際のパケットは、このモジュールを `include` して定義しています。

各パケット/フレームが共通に持っている機能については、
このファイルのコメントとして説明してあります。

チェックサムやイーサタイプなどの一部の項目は、
他のデータを元に自動計算しています。
この機能を停止するには、パケット/フレームインスタンスの 
auto_compile を false にしてください。

コメントじゃない部分は、内部的な細かいことをしています。

### packet/ethernet.rb, arp.rb, ipv4.rb, ipv6.rb, qinq.rb, vlan.rb

各種フレーム, パケットのクラスを定義しています。

### packet/macaddr.rb

MAC アドレスを定義しています。

### packet/ip/

ICMP, UDP, TCP などのレイヤを定義しています。

### func/

VLAN などの仮想的なインターフェースや、L2 switch などの中継機能について
定義しています。
